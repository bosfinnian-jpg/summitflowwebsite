<!--
=================================================================
SUMMITFLOW DASHBOARD INTEGRATION
=================================================================
Add these components to your existing summitflow-dashboard.html

This file contains:
1. Actions Stats Component (for top bar)
2. Quick Action Creation (from log buttons)
3. End Session Logic with Carryover + Recap
4. Full standalone Dashboard if you want to test
=================================================================
-->

<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dashboard | SummitFlow</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Space+Grotesk:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            --bg-primary: #08090A;
            --bg-card: #131416;
            --bg-card-hover: #1a1c1f;
            --bg-elevated: #1d1f23;
            --border-subtle: #2a2d32;
            --border-default: #3a3d42;
            --text-primary: #ffffff;
            --text-secondary: #a1a1aa;
            --text-muted: #71717a;
            --green-primary: #10B981;
            --green-secondary: #059669;
            --green-muted: rgba(16, 185, 129, 0.15);
            --red-primary: #EF4444;
            --red-secondary: #DC2626;
            --red-muted: rgba(239, 68, 68, 0.15);
            --blue-primary: #3B82F6;
            --blue-muted: rgba(59, 130, 246, 0.15);
            --yellow-primary: #F59E0B;
            --yellow-muted: rgba(245, 158, 11, 0.15);
            --purple-primary: #8B5CF6;
            --purple-muted: rgba(139, 92, 246, 0.15);
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: var(--bg-primary);
            color: var(--text-primary);
            min-height: 100vh;
            line-height: 1.5;
        }

        h1, h2, h3, h4, h5, h6 {
            font-family: 'Space Grotesk', sans-serif;
            font-weight: 600;
        }

        /* Navigation */
        .nav {
            background: var(--bg-card);
            border-bottom: 1px solid var(--border-subtle);
            padding: 0 24px;
            position: sticky;
            top: 0;
            z-index: 100;
        }

        .nav-inner {
            max-width: 1400px;
            margin: 0 auto;
            display: flex;
            align-items: center;
            justify-content: space-between;
            height: 64px;
        }

        .nav-brand {
            display: flex;
            align-items: center;
            gap: 12px;
            text-decoration: none;
        }

        .nav-logo {
            width: 36px;
            height: 36px;
            background: linear-gradient(135deg, var(--green-primary), var(--green-secondary));
            border-radius: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 700;
            font-size: 18px;
            color: white;
            font-family: 'Space Grotesk', sans-serif;
        }

        .nav-title {
            font-family: 'Space Grotesk', sans-serif;
            font-size: 20px;
            font-weight: 700;
            color: var(--text-primary);
        }

        .nav-links {
            display: flex;
            gap: 8px;
        }

        .nav-link {
            padding: 8px 16px;
            border-radius: 8px;
            color: var(--text-secondary);
            text-decoration: none;
            font-size: 14px;
            font-weight: 500;
            transition: all 0.2s;
        }

        .nav-link:hover {
            background: var(--bg-elevated);
            color: var(--text-primary);
        }

        .nav-link.active {
            background: var(--green-muted);
            color: var(--green-primary);
        }

        /* Main Content */
        .main {
            max-width: 1400px;
            margin: 0 auto;
            padding: 32px 24px;
        }

        /* Header */
        .header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 32px;
            flex-wrap: wrap;
            gap: 16px;
        }

        .header-left h1 {
            font-size: 28px;
            margin-bottom: 4px;
        }

        .header-subtitle {
            color: var(--text-secondary);
            font-size: 15px;
        }

        /* ================================================
           ACTIONS STATS BAR - ADD THIS TO YOUR DASHBOARD
           ================================================ */
        .actions-bar {
            display: flex;
            gap: 16px;
            margin-bottom: 24px;
            flex-wrap: wrap;
        }

        .action-stat {
            background: var(--bg-card);
            border: 1px solid var(--border-subtle);
            border-radius: 12px;
            padding: 16px 24px;
            display: flex;
            align-items: center;
            gap: 16px;
            cursor: pointer;
            transition: all 0.2s;
            text-decoration: none;
            color: inherit;
        }

        .action-stat:hover {
            border-color: var(--green-primary);
            transform: translateY(-2px);
        }

        .action-stat.has-overdue {
            border-color: var(--red-primary);
            background: linear-gradient(135deg, var(--bg-card) 0%, var(--red-muted) 100%);
            animation: pulse-border 2s infinite;
        }

        @keyframes pulse-border {
            0%, 100% { box-shadow: 0 0 0 0 rgba(239, 68, 68, 0.4); }
            50% { box-shadow: 0 0 0 8px rgba(239, 68, 68, 0); }
        }

        .action-stat-icon {
            width: 48px;
            height: 48px;
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 24px;
        }

        .action-stat-icon.today {
            background: var(--green-muted);
        }

        .action-stat-icon.overdue {
            background: var(--red-muted);
        }

        .action-stat-content h3 {
            font-family: 'Space Grotesk', sans-serif;
            font-size: 28px;
            font-weight: 700;
            line-height: 1;
        }

        .action-stat-content p {
            font-size: 14px;
            color: var(--text-secondary);
            margin-top: 2px;
        }

        .action-stat.has-overdue .action-stat-content h3 {
            color: var(--red-primary);
        }

        /* War Room Stats */
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 16px;
            margin-bottom: 32px;
        }

        .stat-card {
            background: var(--bg-card);
            border: 1px solid var(--border-subtle);
            border-radius: 12px;
            padding: 20px;
        }

        .stat-label {
            font-size: 13px;
            color: var(--text-muted);
            text-transform: uppercase;
            letter-spacing: 0.5px;
            margin-bottom: 8px;
        }

        .stat-value {
            font-family: 'Space Grotesk', sans-serif;
            font-size: 32px;
            font-weight: 700;
        }

        /* Dashboard Grid */
        .dashboard-grid {
            display: grid;
            grid-template-columns: 2fr 1fr;
            gap: 24px;
        }

        @media (max-width: 1024px) {
            .dashboard-grid {
                grid-template-columns: 1fr;
            }
        }

        /* Session Panel */
        .session-panel {
            background: var(--bg-card);
            border: 1px solid var(--border-subtle);
            border-radius: 16px;
            overflow: hidden;
        }

        .session-header {
            padding: 20px 24px;
            border-bottom: 1px solid var(--border-subtle);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .session-title {
            font-size: 18px;
            font-weight: 600;
        }

        .session-timer {
            font-family: 'Space Grotesk', sans-serif;
            font-size: 24px;
            font-weight: 700;
            color: var(--green-primary);
        }

        .session-body {
            padding: 24px;
        }

        /* Current Lead */
        .current-lead {
            background: var(--bg-elevated);
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 20px;
        }

        .current-lead-header {
            display: flex;
            align-items: center;
            gap: 16px;
            margin-bottom: 16px;
        }

        .lead-avatar {
            width: 56px;
            height: 56px;
            background: linear-gradient(135deg, var(--green-primary), var(--green-secondary));
            border-radius: 14px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 700;
            font-size: 20px;
            color: white;
        }

        .lead-info h3 {
            font-size: 18px;
            margin-bottom: 2px;
        }

        .lead-info p {
            font-size: 14px;
            color: var(--text-muted);
        }

        .lead-details {
            display: grid;
            gap: 8px;
        }

        .lead-detail {
            display: flex;
            align-items: center;
            gap: 10px;
            font-size: 14px;
        }

        .lead-detail-icon {
            color: var(--text-muted);
        }

        .lead-detail a {
            color: var(--green-primary);
            text-decoration: none;
        }

        .lead-detail a:hover {
            text-decoration: underline;
        }

        /* ================================================
           OUTCOME BUTTONS - INTEGRATE WITH ACTIONS
           ================================================ */
        .outcome-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 10px;
            margin-top: 20px;
        }

        .outcome-btn {
            padding: 14px 16px;
            background: var(--bg-card);
            border: 1px solid var(--border-subtle);
            border-radius: 10px;
            color: var(--text-primary);
            font-size: 14px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.2s;
            text-align: left;
        }

        .outcome-btn:hover {
            background: var(--bg-elevated);
            border-color: var(--border-default);
        }

        .outcome-btn.positive {
            border-color: var(--green-primary);
            background: var(--green-muted);
        }

        .outcome-btn.positive:hover {
            background: var(--green-primary);
            color: white;
        }

        .outcome-btn.negative {
            border-color: var(--red-primary);
            background: var(--red-muted);
        }

        .outcome-btn.negative:hover {
            background: var(--red-primary);
            color: white;
        }

        /* Quick Actions */
        .quick-actions {
            display: flex;
            gap: 10px;
            margin-top: 20px;
        }

        .btn {
            padding: 12px 20px;
            border-radius: 10px;
            font-size: 14px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.2s;
            border: none;
        }

        .btn-primary {
            background: var(--green-primary);
            color: white;
        }

        .btn-primary:hover {
            background: var(--green-secondary);
        }

        .btn-secondary {
            background: var(--bg-card);
            color: var(--text-primary);
            border: 1px solid var(--border-subtle);
        }

        .btn-secondary:hover {
            background: var(--bg-elevated);
        }

        .btn-danger {
            background: var(--red-muted);
            color: var(--red-primary);
            border: 1px solid var(--red-primary);
        }

        .btn-danger:hover {
            background: var(--red-primary);
            color: white;
        }

        /* Activity Feed */
        .activity-panel {
            background: var(--bg-card);
            border: 1px solid var(--border-subtle);
            border-radius: 16px;
            overflow: hidden;
        }

        .activity-header {
            padding: 20px 24px;
            border-bottom: 1px solid var(--border-subtle);
        }

        .activity-list {
            max-height: 500px;
            overflow-y: auto;
        }

        .activity-item {
            padding: 16px 24px;
            border-bottom: 1px solid var(--border-subtle);
            display: flex;
            gap: 12px;
        }

        .activity-item:last-child {
            border-bottom: none;
        }

        .activity-icon {
            width: 32px;
            height: 32px;
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 14px;
            flex-shrink: 0;
        }

        .activity-icon.call {
            background: var(--blue-muted);
        }

        .activity-icon.meeting {
            background: var(--green-muted);
        }

        .activity-icon.email {
            background: var(--purple-muted);
        }

        .activity-content {
            flex: 1;
        }

        .activity-text {
            font-size: 14px;
            margin-bottom: 2px;
        }

        .activity-time {
            font-size: 12px;
            color: var(--text-muted);
        }

        /* ================================================
           RECAP MODAL - SESSION END
           ================================================ */
        .modal-overlay {
            position: fixed;
            inset: 0;
            background: rgba(0, 0, 0, 0.7);
            backdrop-filter: blur(4px);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 1000;
            opacity: 0;
            visibility: hidden;
            transition: all 0.2s;
        }

        .modal-overlay.active {
            opacity: 1;
            visibility: visible;
        }

        .modal {
            background: var(--bg-card);
            border: 1px solid var(--border-subtle);
            border-radius: 20px;
            width: 100%;
            max-width: 480px;
            transform: scale(0.95);
            transition: transform 0.2s;
        }

        .modal-overlay.active .modal {
            transform: scale(1);
        }

        .modal-header {
            padding: 24px 24px 0;
            display: flex;
            align-items: center;
            justify-content: space-between;
        }

        .modal-title {
            font-size: 20px;
            font-weight: 600;
        }

        .modal-close {
            width: 36px;
            height: 36px;
            border: none;
            background: var(--bg-elevated);
            color: var(--text-secondary);
            border-radius: 10px;
            cursor: pointer;
            font-size: 18px;
        }

        .modal-body {
            padding: 24px;
        }

        .modal-actions {
            padding: 0 24px 24px;
            display: flex;
            gap: 12px;
            justify-content: flex-end;
        }

        .recap-stats {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 12px;
            margin-bottom: 24px;
        }

        .recap-stat {
            text-align: center;
            padding: 16px;
            background: var(--bg-elevated);
            border-radius: 12px;
        }

        .recap-stat-value {
            font-family: 'Space Grotesk', sans-serif;
            font-size: 28px;
            font-weight: 700;
        }

        .recap-stat-value.completed {
            color: var(--green-primary);
        }

        .recap-stat-value.skipped {
            color: var(--yellow-primary);
        }

        .recap-stat-value.carried {
            color: var(--blue-primary);
        }

        .recap-stat-label {
            font-size: 12px;
            color: var(--text-muted);
            margin-top: 4px;
        }

        .recap-tomorrow {
            background: var(--green-muted);
            border-radius: 12px;
            padding: 16px;
            text-align: center;
        }

        .recap-tomorrow-label {
            font-size: 13px;
            color: var(--text-secondary);
            margin-bottom: 4px;
        }

        .recap-tomorrow-count {
            font-family: 'Space Grotesk', sans-serif;
            font-size: 24px;
            font-weight: 700;
            color: var(--green-primary);
        }

        /* Follow-up Modal */
        .form-group {
            margin-bottom: 16px;
        }

        .form-label {
            display: block;
            font-size: 14px;
            font-weight: 500;
            color: var(--text-secondary);
            margin-bottom: 8px;
        }

        .form-select {
            width: 100%;
            padding: 12px 16px;
            background: var(--bg-elevated);
            border: 1px solid var(--border-subtle);
            border-radius: 10px;
            color: var(--text-primary);
            font-size: 14px;
        }

        .form-select:focus {
            outline: none;
            border-color: var(--green-primary);
        }

        /* Responsive */
        @media (max-width: 768px) {
            .nav-inner {
                flex-direction: column;
                height: auto;
                padding: 12px 0;
                gap: 12px;
            }

            .actions-bar {
                flex-direction: column;
            }

            .outcome-grid {
                grid-template-columns: 1fr;
            }

            .recap-stats {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <!-- Navigation -->
    <nav class="nav">
        <div class="nav-inner">
            <a href="#" class="nav-brand">
                <div class="nav-logo">S</div>
                <span class="nav-title">SummitFlow</span>
            </a>
            <div class="nav-links">
                <a href="summitflow-leads.html" class="nav-link">Leads Hub</a>
                <a href="summitflow-pipeline.html" class="nav-link">Pipeline</a>
                <a href="summitflow-dashboard.html" class="nav-link active">Dashboard</a>
                <a href="summitflow-calendar.html" class="nav-link">Calendar</a>
            </div>
        </div>
    </nav>

    <!-- Main Content -->
    <main class="main">
        <!-- Header -->
        <div class="header">
            <div class="header-left">
                <h1>‚öîÔ∏è War Room</h1>
                <p class="header-subtitle">Wednesday, January 8, 2026</p>
            </div>
        </div>

        <!-- ================================================
             ACTIONS STATS BAR - THE KEY INTEGRATION
             ================================================ -->
        <div class="actions-bar">
            <a href="summitflow-calendar.html" class="action-stat" id="todayActionsStat">
                <div class="action-stat-icon today">üìã</div>
                <div class="action-stat-content">
                    <h3 id="todayActionsCount">0</h3>
                    <p>actions planned today</p>
                </div>
            </a>
            <a href="summitflow-calendar.html" class="action-stat" id="overdueActionsStat" style="display: none;">
                <div class="action-stat-icon overdue">‚ö†Ô∏è</div>
                <div class="action-stat-content">
                    <h3 id="overdueActionsCount">0</h3>
                    <p>overdue actions</p>
                </div>
            </a>
        </div>

        <!-- Stats Grid -->
        <div class="stats-grid">
            <div class="stat-card">
                <div class="stat-label">üìû Calls Today</div>
                <div class="stat-value" id="callsToday">0</div>
            </div>
            <div class="stat-card">
                <div class="stat-label">üéØ Connections</div>
                <div class="stat-value" id="connections">0</div>
            </div>
            <div class="stat-card">
                <div class="stat-label">üìÖ Meetings Booked</div>
                <div class="stat-value" id="meetingsBooked">0</div>
            </div>
            <div class="stat-card">
                <div class="stat-label">‚è±Ô∏è Session Time</div>
                <div class="stat-value" id="sessionTime">0:00</div>
            </div>
        </div>

        <!-- Dashboard Grid -->
        <div class="dashboard-grid">
            <!-- Session Panel -->
            <div class="session-panel">
                <div class="session-header">
                    <h2 class="session-title">Current Call</h2>
                    <div class="session-timer" id="callTimer">0:00</div>
                </div>
                <div class="session-body">
                    <!-- Current Lead -->
                    <div class="current-lead" id="currentLeadPanel">
                        <div class="current-lead-header">
                            <div class="lead-avatar" id="currentLeadAvatar">?</div>
                            <div class="lead-info">
                                <h3 id="currentLeadName">No lead selected</h3>
                                <p id="currentLeadCompany">Select a lead or start from queue</p>
                            </div>
                        </div>
                        <div class="lead-details" id="currentLeadDetails" style="display: none;">
                            <div class="lead-detail">
                                <span class="lead-detail-icon">üìû</span>
                                <a href="#" id="currentLeadPhone">-</a>
                            </div>
                            <div class="lead-detail">
                                <span class="lead-detail-icon">‚úâÔ∏è</span>
                                <span id="currentLeadEmail">-</span>
                            </div>
                        </div>
                    </div>

                    <!-- ================================================
                         OUTCOME BUTTONS - WITH ACTION INTEGRATION
                         ================================================ -->
                    <h4 style="margin-bottom: 12px; color: var(--text-secondary);">Log Outcome</h4>
                    <div class="outcome-grid">
                        <button class="outcome-btn positive" onclick="logOutcome('Meeting booked')">
                            üéâ Meeting Booked
                        </button>
                        <button class="outcome-btn" onclick="logOutcome('Interested - send info')">
                            ‚ú® Interested
                        </button>
                        <button class="outcome-btn" onclick="logOutcome('Callback requested')">
                            üìû Callback Requested
                        </button>
                        <button class="outcome-btn" onclick="logOutcome('Voicemail left')">
                            üì´ Voicemail Left
                        </button>
                        <button class="outcome-btn" onclick="logOutcome('No answer')">
                            ‚ùå No Answer
                        </button>
                        <button class="outcome-btn" onclick="logOutcome('Gatekeeper - try again')">
                            üöß Gatekeeper
                        </button>
                        <button class="outcome-btn negative" onclick="logOutcome('Not interested')">
                            üëé Not Interested
                        </button>
                        <button class="outcome-btn negative" onclick="logOutcome('Wrong number')">
                            ‚ùì Wrong Number
                        </button>
                    </div>

                    <!-- Quick Actions -->
                    <div class="quick-actions">
                        <button class="btn btn-primary" id="nextLeadBtn">Next Lead ‚Üí</button>
                        <button class="btn btn-secondary" onclick="skipLead()">Skip</button>
                        <button class="btn btn-danger" id="endSessionBtn">End Session</button>
                    </div>
                </div>
            </div>

            <!-- Activity Feed -->
            <div class="activity-panel">
                <div class="activity-header">
                    <h2 class="session-title">Today's Activity</h2>
                </div>
                <div class="activity-list" id="activityList">
                    <div class="activity-item">
                        <div class="activity-icon call">üìû</div>
                        <div class="activity-content">
                            <div class="activity-text">No activity yet</div>
                            <div class="activity-time">Start calling to see your progress</div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </main>

    <!-- Session Recap Modal -->
    <div class="modal-overlay" id="recapModal">
        <div class="modal">
            <div class="modal-header">
                <h3 class="modal-title">üåô Session Complete</h3>
                <button class="modal-close" onclick="closeModal('recapModal')">√ó</button>
            </div>
            <div class="modal-body">
                <div class="recap-stats">
                    <div class="recap-stat">
                        <div class="recap-stat-value completed" id="recapCompleted">0</div>
                        <div class="recap-stat-label">Completed</div>
                    </div>
                    <div class="recap-stat">
                        <div class="recap-stat-value skipped" id="recapSkipped">0</div>
                        <div class="recap-stat-label">Skipped</div>
                    </div>
                    <div class="recap-stat">
                        <div class="recap-stat-value carried" id="recapCarried">0</div>
                        <div class="recap-stat-label">Carried Over</div>
                    </div>
                </div>
                <div class="recap-tomorrow">
                    <div class="recap-tomorrow-label">Tomorrow you have</div>
                    <div class="recap-tomorrow-count"><span id="recapTomorrowCount">0</span> actions</div>
                </div>
            </div>
            <div class="modal-actions">
                <button class="btn btn-secondary" onclick="closeModal('recapModal')">Done</button>
                <button class="btn btn-primary" onclick="window.location.href='summitflow-calendar.html'">View Calendar ‚Üí</button>
            </div>
        </div>
    </div>

    <!-- Follow-up Modal (shown after certain outcomes) -->
    <div class="modal-overlay" id="followUpModal">
        <div class="modal">
            <div class="modal-header">
                <h3 class="modal-title">üìÖ Schedule Follow-up</h3>
                <button class="modal-close" onclick="closeModal('followUpModal')">√ó</button>
            </div>
            <div class="modal-body">
                <p style="margin-bottom: 16px; color: var(--text-secondary);">
                    When should you follow up with <strong id="followUpLeadName">this lead</strong>?
                </p>
                <div class="form-group">
                    <select class="form-select" id="followUpDate">
                        <option value="tomorrow">Tomorrow</option>
                        <option value="2days">In 2 days</option>
                        <option value="3days">In 3 days</option>
                        <option value="week">Next week</option>
                    </select>
                </div>
            </div>
            <div class="modal-actions">
                <button class="btn btn-secondary" onclick="skipFollowUp()">Skip</button>
                <button class="btn btn-primary" onclick="createFollowUp()">Create Follow-up</button>
            </div>
        </div>
    </div>

    <script>
        // ==========================================
        // SUMMITFLOW DASHBOARD - WITH ACTIONS INTEGRATION
        // ==========================================

        // LocalStorage Keys (shared with Calendar)
        const ACTIONS_KEY = 'summitflow_v3_actions';
        const LEADS_KEY = 'summitflow_v3_leads';
        const LOGS_KEY = 'summitflow_v3_logs';

        // State
        let actions = [];
        let leads = [];
        let currentLeadIndex = 0;
        let currentLead = null;
        let sessionStartTime = null;
        let callStartTime = null;
        let timerInterval = null;
        let sessionStats = {
            calls: 0,
            connections: 0,
            meetings: 0
        };
        let pendingOutcome = null;

        // ==========================================
        // UTILITY FUNCTIONS
        // ==========================================

        function generateId() {
            return 'action_' + Date.now() + '_' + Math.random().toString(36).substr(2, 9);
        }

        function getToday() {
            return new Date().toISOString().split('T')[0];
        }

        function getTomorrow() {
            const tomorrow = new Date();
            tomorrow.setDate(tomorrow.getDate() + 1);
            return tomorrow.toISOString().split('T')[0];
        }

        function formatTime(seconds) {
            const mins = Math.floor(seconds / 60);
            const secs = seconds % 60;
            return `${mins}:${secs.toString().padStart(2, '0')}`;
        }

        function getLeadInitials(lead) {
            if (!lead) return '?';
            const name = lead.contactName || lead.company || 'Unknown';
            return name.split(' ').map(w => w[0]).join('').toUpperCase().slice(0, 2);
        }

        // ==========================================
        // DATA PERSISTENCE
        // ==========================================

        function loadData() {
            try {
                const actionsData = localStorage.getItem(ACTIONS_KEY);
                actions = actionsData ? JSON.parse(actionsData) : [];

                const leadsData = localStorage.getItem(LEADS_KEY);
                leads = leadsData ? JSON.parse(leadsData) : [];
            } catch (e) {
                console.error('Error loading data:', e);
                actions = [];
                leads = [];
            }
        }

        function saveActions() {
            try {
                localStorage.setItem(ACTIONS_KEY, JSON.stringify(actions));
            } catch (e) {
                console.error('Error saving actions:', e);
            }
        }

        // ==========================================
        // ACTIONS INTEGRATION
        // ==========================================

        function updateActionStats() {
            const today = getToday();

            // Today's planned actions
            const todayPlanned = actions.filter(a => a.date === today && a.status === 'planned').length;
            document.getElementById('todayActionsCount').textContent = todayPlanned;

            // Overdue actions
            const overdue = actions.filter(a => a.date < today && a.status === 'planned').length;
            document.getElementById('overdueActionsCount').textContent = overdue;

            // Show/hide overdue stat
            const overdueStat = document.getElementById('overdueActionsStat');
            if (overdue > 0) {
                overdueStat.style.display = 'flex';
                overdueStat.classList.add('has-overdue');
            } else {
                overdueStat.style.display = 'none';
            }
        }

        function createAction(data) {
            const action = {
                id: generateId(),
                leadId: data.leadId,
                type: data.type || 'follow_up',
                status: 'planned',
                date: data.date || getToday(),
                time: data.time || '',
                notes: data.notes || '',
                outcome: '',
                createdAt: new Date().toISOString(),
                completedAt: null
            };

            actions.push(action);
            saveActions();
            return action;
        }

        function markActionComplete(leadId, outcome) {
            const today = getToday();
            
            // Find today's action for this lead
            const actionIndex = actions.findIndex(a => 
                a.leadId === leadId && 
                a.date <= today && 
                a.status === 'planned'
            );

            if (actionIndex !== -1) {
                actions[actionIndex].status = 'completed';
                actions[actionIndex].outcome = outcome;
                actions[actionIndex].completedAt = new Date().toISOString();
                saveActions();
            }
        }

        function getFollowUpDate(option) {
            const days = {
                'tomorrow': 1,
                '2days': 2,
                '3days': 3,
                'week': 7
            };
            const d = new Date();
            d.setDate(d.getDate() + (days[option] || 1));
            return d.toISOString().split('T')[0];
        }

        // ==========================================
        // SESSION MANAGEMENT
        // ==========================================

        function startSession() {
            sessionStartTime = new Date();
            updateSessionTimer();
            setInterval(updateSessionTimer, 1000);
        }

        function updateSessionTimer() {
            if (!sessionStartTime) return;
            const elapsed = Math.floor((new Date() - sessionStartTime) / 1000);
            document.getElementById('sessionTime').textContent = formatTime(elapsed);
        }

        function startCallTimer() {
            callStartTime = new Date();
            if (timerInterval) clearInterval(timerInterval);
            timerInterval = setInterval(() => {
                const elapsed = Math.floor((new Date() - callStartTime) / 1000);
                document.getElementById('callTimer').textContent = formatTime(elapsed);
            }, 1000);
        }

        function stopCallTimer() {
            if (timerInterval) {
                clearInterval(timerInterval);
                timerInterval = null;
            }
            document.getElementById('callTimer').textContent = '0:00';
        }

        // ==========================================
        // OUTCOME LOGGING - WITH AUTO FOLLOW-UP
        // ==========================================

        function logOutcome(outcome) {
            if (!currentLead) {
                alert('No lead selected');
                return;
            }

            sessionStats.calls++;
            document.getElementById('callsToday').textContent = sessionStats.calls;

            // Track connections and meetings
            const connectionOutcomes = ['Meeting booked', 'Interested - send info', 'Callback requested'];
            if (connectionOutcomes.includes(outcome)) {
                sessionStats.connections++;
                document.getElementById('connections').textContent = sessionStats.connections;
            }

            if (outcome === 'Meeting booked') {
                sessionStats.meetings++;
                document.getElementById('meetingsBooked').textContent = sessionStats.meetings;
            }

            // Mark action as complete
            markActionComplete(currentLead.id, outcome);

            // Add to activity feed
            addActivity(outcome);

            // Check if follow-up needed
            const followUpOutcomes = ['Callback requested', 'Voicemail left', 'Gatekeeper - try again', 'Interested - send info'];
            if (followUpOutcomes.includes(outcome)) {
                pendingOutcome = outcome;
                document.getElementById('followUpLeadName').textContent = currentLead.contactName || currentLead.company;
                openModal('followUpModal');
            } else {
                // Move to next lead
                nextLead();
            }
        }

        function createFollowUp() {
            if (!currentLead || !pendingOutcome) return;

            const dateOption = document.getElementById('followUpDate').value;
            const followUpDate = getFollowUpDate(dateOption);

            createAction({
                leadId: currentLead.id,
                type: 'follow_up',
                date: followUpDate,
                notes: 'Follow-up from: ' + pendingOutcome
            });

            closeModal('followUpModal');
            pendingOutcome = null;
            nextLead();

            // Update stats
            updateActionStats();
        }

        function skipFollowUp() {
            closeModal('followUpModal');
            pendingOutcome = null;
            nextLead();
        }

        function addActivity(outcome) {
            const list = document.getElementById('activityList');
            const time = new Date().toLocaleTimeString('en-GB', { hour: '2-digit', minute: '2-digit' });
            
            const iconClass = outcome.includes('Meeting') ? 'meeting' : 
                             outcome.includes('Email') ? 'email' : 'call';
            const icon = outcome.includes('Meeting') ? 'üéâ' : 
                        outcome.includes('Email') ? '‚úâÔ∏è' : 'üìû';

            const item = document.createElement('div');
            item.className = 'activity-item';
            item.innerHTML = `
                <div class="activity-icon ${iconClass}">${icon}</div>
                <div class="activity-content">
                    <div class="activity-text">${currentLead.contactName || currentLead.company}: ${outcome}</div>
                    <div class="activity-time">${time}</div>
                </div>
            `;

            list.insertBefore(item, list.firstChild);
        }

        // ==========================================
        // LEAD NAVIGATION
        // ==========================================

        function loadCurrentLead() {
            if (leads.length === 0) {
                document.getElementById('currentLeadName').textContent = 'No leads available';
                document.getElementById('currentLeadCompany').textContent = 'Import leads to get started';
                return;
            }

            // Get leads that need calling (have actions today or are in queue)
            const callableLeads = leads.filter(l => l.stage === 'New' || l.stage === 'Contacted');
            
            if (currentLeadIndex >= callableLeads.length) {
                currentLeadIndex = 0;
            }

            currentLead = callableLeads[currentLeadIndex] || leads[0];
            
            if (currentLead) {
                document.getElementById('currentLeadAvatar').textContent = getLeadInitials(currentLead);
                document.getElementById('currentLeadName').textContent = currentLead.contactName || 'Unknown';
                document.getElementById('currentLeadCompany').textContent = currentLead.company || '';
                document.getElementById('currentLeadPhone').textContent = currentLead.phone || '-';
                document.getElementById('currentLeadPhone').href = currentLead.phone ? `tel:${currentLead.phone}` : '#';
                document.getElementById('currentLeadEmail').textContent = currentLead.email || '-';
                document.getElementById('currentLeadDetails').style.display = 'block';

                startCallTimer();
            }
        }

        function nextLead() {
            currentLeadIndex++;
            loadCurrentLead();
        }

        function skipLead() {
            // Mark current action as skipped if exists
            if (currentLead) {
                const today = getToday();
                const actionIndex = actions.findIndex(a => 
                    a.leadId === currentLead.id && 
                    a.date <= today && 
                    a.status === 'planned'
                );

                if (actionIndex !== -1) {
                    actions[actionIndex].status = 'skipped';
                    saveActions();
                }
            }

            nextLead();
        }

        // ==========================================
        // END SESSION - WITH CARRYOVER
        // ==========================================

        function endSession() {
            const today = getToday();
            const tomorrow = getTomorrow();

            // Get today's action stats
            const todayActions = actions.filter(a => a.date === today);
            const completed = todayActions.filter(a => a.status === 'completed').length;
            const skipped = todayActions.filter(a => a.status === 'skipped').length;

            // Carry over remaining planned actions
            let carried = 0;
            actions.forEach(action => {
                if (action.date <= today && action.status === 'planned') {
                    action.date = tomorrow;
                    action.notes = (action.notes ? action.notes + ' ' : '') + '[Carried from ' + today + ']';
                    carried++;
                }
            });

            saveActions();

            // Count tomorrow's actions
            const tomorrowCount = actions.filter(a => a.date === tomorrow && a.status === 'planned').length;

            // Show recap
            document.getElementById('recapCompleted').textContent = completed;
            document.getElementById('recapSkipped').textContent = skipped;
            document.getElementById('recapCarried').textContent = carried;
            document.getElementById('recapTomorrowCount').textContent = tomorrowCount;

            openModal('recapModal');
        }

        // ==========================================
        // MODAL HELPERS
        // ==========================================

        function openModal(id) {
            document.getElementById(id).classList.add('active');
        }

        function closeModal(id) {
            document.getElementById(id).classList.remove('active');
        }

        // ==========================================
        // INITIALIZATION
        // ==========================================

        function init() {
            loadData();
            updateActionStats();
            loadCurrentLead();
            startSession();

            // Event listeners
            document.getElementById('nextLeadBtn').addEventListener('click', nextLead);
            document.getElementById('endSessionBtn').addEventListener('click', endSession);

            // Close modals on overlay click
            document.querySelectorAll('.modal-overlay').forEach(overlay => {
                overlay.addEventListener('click', function(e) {
                    if (e.target === this) {
                        this.classList.remove('active');
                    }
                });
            });

            console.log('üöÄ SummitFlow Dashboard initialized');
            console.log(`üìã ${actions.length} actions loaded`);
            console.log(`üë• ${leads.length} leads available`);
        }

        document.addEventListener('DOMContentLoaded', init);
    </script>
</body>
</html>
